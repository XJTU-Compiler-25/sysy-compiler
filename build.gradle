plugins {
    id 'java'
    id 'antlr'
}

group = 'cn.edu.xjtu.sysy'
version = '0.0.1'

repositories {
    maven { url = "https://maven.aliyun.com/repository/public" }
    mavenCentral()
}

dependencies {
    antlr 'org.antlr:antlr4:4.13.2'
    runtimeOnly 'org.antlr:antlr4-runtime:4.13.2'

    testImplementation platform('org.junit:junit-bom:5.12.0')
    testImplementation 'org.junit.jupiter:junit-jupiter'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}

test {
    useJUnitPlatform()
}

compileJava {
    sourceCompatibility = targetCompatibility = 17
}

compileTestJava {
    sourceCompatibility = targetCompatibility = 17
}

generateGrammarSource {
    maxHeapSize '512m'
    arguments = ['-long-messages', '-no-listener', '-visitor']
    outputDirectory = new File("build/generated-src/antlr/main/cn/edu/xjtu/sysy/parse")
}

compileJava.dependsOn(generateGrammarSource)
compileTestJava.dependsOn(generateTestGrammarSource)
